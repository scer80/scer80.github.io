---
layout: contents
---

# ODE-SDE Equivalence

## Setup

Consider an ODE that transports a probability density $p_t$ from an initial distribution $p_0$ to a target:

$$\frac{dx(t)}{dt} = u_t(x(t))$$

where $u_t$ is a time-dependent vector field. The density $p_t$ generated by this ODE satisfies the **continuity equation** (see [Continuity Equation](odes/continuity_equation.md)):

$$\partial_t p_t(x) = -\nabla \cdot \big( p_t(x)\, u_t(x) \big) \tag{CE}$$

Now consider a general SDE with added noise:

$$dx(t) = \tilde{u}_t(x(t))\, dt + \sigma_t\, dW_t$$

where $\sigma_t \geq 0$ is a time-dependent noise schedule and $W_t$ is a Wiener process. The density generated by this SDE satisfies the **Fokker-Planck equation** (see [Diffusion SDE -- Fokker-Planck](diffusion_sde.md)):

$$\partial_t p_t(x) = -\nabla \cdot \big( p_t(x)\, \tilde{u}_t(x) \big) + \frac{\sigma_t^2}{2} \Delta p_t(x) \tag{FP}$$

**Question:** Can we choose a drift $\tilde{u}_t$ for the SDE so that it generates the *same* density evolution $p_t$ as the original ODE?

## Theorem

For any noise schedule $\sigma_t \geq 0$, the SDE

$$\boxed{dx(t) = \left[ u_t(x(t)) + \frac{\sigma_t^2}{2} \nabla \log p_t(x(t)) \right] dt + \sigma_t\, dW_t}$$

generates the same probability path $p_t$ as the ODE $dx(t) = u_t(x(t))\, dt$.

Setting $\sigma_t = 0$ recovers the original ODE (the **probability flow ODE**).

## Proof

We need to verify that the density $p_t$ satisfying (CE) also satisfies (FP) when we set $\tilde{u}_t = u_t + \frac{\sigma_t^2}{2} \nabla \log p_t$.

**Step 1.** Substitute the proposed drift into the Fokker-Planck equation (FP):

$$\partial_t p_t = -\nabla \cdot \left( p_t \left[ u_t + \frac{\sigma_t^2}{2} \nabla \log p_t \right] \right) + \frac{\sigma_t^2}{2} \Delta p_t$$

**Step 2.** Expand the divergence:

$$\partial_t p_t = -\nabla \cdot (p_t\, u_t) - \frac{\sigma_t^2}{2} \nabla \cdot \big( p_t \nabla \log p_t \big) + \frac{\sigma_t^2}{2} \Delta p_t$$

**Step 3.** Simplify the score term. Since $\nabla \log p_t = \frac{\nabla p_t}{p_t}$:

$$p_t \nabla \log p_t = p_t \cdot \frac{\nabla p_t}{p_t} = \nabla p_t$$

Therefore:

$$\nabla \cdot (p_t \nabla \log p_t) = \nabla \cdot (\nabla p_t) = \Delta p_t$$

**Step 4.** Substitute back:

$$\partial_t p_t = -\nabla \cdot (p_t\, u_t) - \frac{\sigma_t^2}{2} \Delta p_t + \frac{\sigma_t^2}{2} \Delta p_t$$

The two $\frac{\sigma_t^2}{2} \Delta p_t$ terms cancel exactly, leaving:

$$\partial_t p_t = -\nabla \cdot (p_t\, u_t)$$

This is precisely the continuity equation (CE). $\square$

## Intuition

The noise $\sigma_t\, dW_t$ in the SDE spreads the density out — it contributes the $+\frac{\sigma_t^2}{2} \Delta p_t$ diffusion term in the Fokker-Planck equation. To counteract this spreading without changing $p_t$, we add a **score correction** $\frac{\sigma_t^2}{2} \nabla \log p_t$ to the drift. The score $\nabla \log p_t$ points toward high-density regions, so this correction pulls particles back toward where $p_t$ is concentrated, exactly canceling the diffusion.

The cancellation is algebraically exact because $\nabla \cdot (p_t \nabla \log p_t) = \Delta p_t$ — the divergence of the score-weighted density *is* the Laplacian of the density.

## Special Cases

- **$\sigma_t = 0$:** The SDE reduces to the original ODE $dx(t) = u_t(x(t))\, dt$. This is the **probability flow ODE**, a deterministic sampler.
- **$u_t = 0$:** The SDE becomes a pure score-based diffusion: $dx(t) = \frac{\sigma_t^2}{2} \nabla \log p_t(x(t))\, dt + \sigma_t\, dW_t$, which is Langevin-type dynamics that preserves $p_t$.
- **Practical tradeoff:** ODE samplers ($\sigma_t = 0$) are fast but can produce lower-quality samples. SDE samplers ($\sigma_t > 0$) inject stochasticity that can improve sample quality at the cost of more function evaluations.
