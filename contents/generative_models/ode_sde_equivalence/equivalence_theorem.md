---
layout: contents
---

# ODE-SDE Equivalence

## Setup

Consider an ODE that transports a probability density $p_t$ from an initial distribution $p_0$ to a target:

$$\frac{dx(t)}{dt} = u_t(x(t)) \tag{ODE}$$

where $u_t$ is a time-dependent vector field. The density $p_t$ generated by this ODE satisfies the **continuity equation** (see [Continuity Equation](../odes/continuity_equation.md)):

$$\partial_t p_t(x) = -\nabla \cdot \big( p_t(x)\, u_t(x) \big) \tag{CE}$$

Now consider a general SDE with added noise:

$$dx(t) = \tilde{u}_t(x(t))\, dt + \sigma_t\, dW_t \tag{SDE}$$

where $\sigma_t \geq 0$ is a time-dependent noise schedule and $W_t$ is a Wiener process. The density generated by this SDE satisfies the **Fokker-Planck equation** (see [Wiener Process Fokker-Planck](../sdes/wp_fokker_planck.md)):

$$\partial_t q_t(x) = -\nabla \cdot \big( q_t(x)\, \tilde{u}_t(x) \big) + \frac{\sigma_t^2}{2} \Delta q_t(x) \tag{FP}$$

**Question:** Can we choose a drift $\tilde{u}_t$ for the SDE so that it generates the *same* density evolution $p_t$ (i.e. $q_t = p_t$) as the original ODE?

## Theorem

For any noise schedule $\sigma_t \geq 0$, the SDE

$$\boxed{dx(t) = \left[ u_t(x(t)) + \frac{\sigma_t^2}{2} \nabla \log p_t(x(t)) \right] dt + \sigma_t\, dW_t}$$

generates the same probability path $p_t$ as the ODE $dx(t) = u_t(x(t))\, dt$.

Setting $\sigma_t = 0$ recovers the original ODE (the **probability flow ODE**).

## Proof

We need to verify that the density $q_t$ satisfying (FP) is equal to $p_t$ when we set $\tilde{u}_t = u_t + \frac{\sigma_t^2}{2} \nabla \log p_t$.

**Step 1.** Substitute the proposed drift into the Fokker-Planck equation (FP):

$$\partial_t p_t = -\nabla \cdot \left( p_t \left[ u_t + \frac{\sigma_t^2}{2} \nabla \log p_t \right] \right) + \frac{\sigma_t^2}{2} \Delta p_t$$

**Step 2.** Expand the divergence:

$$\partial_t p_t = -\nabla \cdot (p_t\, u_t) - \frac{\sigma_t^2}{2} \nabla \cdot \big( p_t \nabla \log p_t \big) + \frac{\sigma_t^2}{2} \Delta p_t$$

**Step 3.** Simplify the score term. Since $\nabla \log p_t = \frac{\nabla p_t}{p_t}$:

$$p_t \nabla \log p_t = p_t \cdot \frac{\nabla p_t}{p_t} = \nabla p_t$$

Therefore:

$$\nabla \cdot (p_t \nabla \log p_t) = \nabla \cdot (\nabla p_t) = \Delta p_t$$

**Step 4.** Substitute back:

$$\partial_t p_t = -\nabla \cdot (p_t\, u_t) - \frac{\sigma_t^2}{2} \Delta p_t + \frac{\sigma_t^2}{2} \Delta p_t$$

The two $\frac{\sigma_t^2}{2} \Delta p_t$ terms cancel exactly, leaving:

$$\partial_t p_t = -\nabla \cdot (p_t\, u_t)$$

This is precisely the continuity equation (CE). $\square$
